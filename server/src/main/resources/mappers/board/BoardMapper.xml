<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.management.mapper.board.BoardMapper">
	<resultMap type="hashmap" id="selectMap">
		<result column="bno" property="bno"/>
		<result column="b_kinds" property="bKinds"/>
		<result column="create_dt" property="createDt"/>
		<result column="update_dt" property="updateDt"/>
		<result column="content" property="content"/>
		<result column="name" property="name"/>
		<result column="update_yn" property="updateYn"/>
		<result column="viewcnt" property="viewcnt"/>
		<result column="writer" property="writer"/>
	</resultMap>
	<resultMap type="com.management.domain.model.Board" id="selectList">
		<result column="bno" property="bno"/>
		<result column="b_kinds" property="bKinds"/>
		<result column="create_dt" property="createDt"/>
		<result column="update_dt" property="updateDt"/>
		<result column="content" property="content"/>
		<result column="name" property="name"/>
		<result column="update_yn" property="updateYn"/>
		<result column="viewcnt" property="viewcnt"/>
		<result column="writer" property="writer"/>
		<result column="writer_no" property="writerNo"/>
	</resultMap>
	
	<select id="boardList" parameterType="hashmap" resultType="hashmap">
		SELECT 
			b.bno,
			b.content,
			b.create_dt as createDt,
			b.update_dt as updateDt,
			b.title,
			b.update_yn as updateYn,
			b.viewcnt,
			b.writer,
			b.writer_no as writerNo,
			b.write_yn as writeYn,
			b.brd_code as bKinds,
			m.profile_img as profileImg,
			k.show_text as showText,
			k.brd_text as brdText
		FROM 
		board b INNER JOIN member_info m
		ON b.writer_no = m.member_no
		INNER JOIN board_kinds k
		ON b.brd_code = k.brd_code
		AND use_yn = 'Y'
		AND del_yn = 'N'
		<if test="brdText != null and !brdText.equals('')">
			AND k.brd_code = (SELECT brd_code FROM board_kinds WHERE brd_text = #{brdText})
		</if>
		<if test="bno != null">
			AND bno = #{bno}
		</if>
		
		ORDER BY b.bno DESC
		
		<if test="start != null and end != null">
			LIMIT #{start}, #{end}
		</if>
	</select>
	
	<select id="getViewcnt" parameterType="Long" resultType="Long">
		SELECT viewcnt FROM board WHERE bno = #{bno}
	</select>
	
	<update id="deleteBoard" parameterType="Long">
		UPDATE board SET
			del_yn = 'Y',
			use_yn = 'N'
		WHERE 1=1 
		<if test="bno != null">
			AND bno = #{bno}
		</if>
		
	</update>
	
	<update id="updateBoard" parameterType="com.management.domain.model.Board">
		UPDATE board SET
			<if test="title != null and !title.equals('')">
				title = #{title},
			</if>
			<if test="content != null and !content.equals('')">
				content = #{content},
			</if>
			<if test="brdCode != null and !brdCode.equals('')">
				brd_code = #{brdCode},
			</if>
			<if test="updateYn != null and !updateYn.equals('')">
				update_yn = #{updateYn},
			</if>
			<if test="title != null and !title.equals('')">
				update_dt = SYSDATE()
			</if>
			<if test="viewcnt != null">
				viewcnt = #{viewcnt} + 1
			</if>
			<if test="writer != null and !writer.equals('')">
				writer = #{writer}
			</if>
		WHERE 1=1
		<if test="bno != null">
			AND bno = #{bno}
		</if>
		<if test="writerNo != null">
			AND writer_no = #{writerNo}
		</if>
	</update>
	
	<select id="boardCount" parameterType="hashmap" resultType="int">
		SELECT count(*) FROM board 
		WHERE 
		brd_code = (SELECT brd_code FROM board_kinds WHERE brd_text = #{brdText})
		AND use_yn = 'Y'
		AND del_yn = 'N'
	</select>
</mapper>
